//
//  MarketDataModel.swift
//  SwiftCrypto
//
//  Created by Mert Durkaya on 07/04/2024.
//

import Foundation

// JSON Data
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 13697,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1046,
     "total_market_cap": {
       "btc": 39150177.83526257,
       "eth": 797899600.3036125,
       "ltc": 26765879167.378006,
       "bch": 3886842840.915621,
       "bnb": 4572241661.987183,
       "eos": 2644490652263.5874,
       "xrp": 4543819884609.487,
       "xlm": 20857599944355.2,
       "link": 153139558422.26868,
       "dot": 316971104995.83813,
       "yfi": 320798241.9337178,
       "usd": 2678318805004.3896,
       "aed": 9835590147617.617,
       "ars": 2304850147272312.5,
       "aud": 4069839340144.4326,
       "bdt": 293542436687223.44,
       "bhd": 1009683336385.7766,
       "bmd": 2678318805004.3896,
       "brl": 13568604114844.69,
       "cad": 3639969171941.218,
       "chf": 2415530198813.7764,
       "clp": 2542929789411421,
       "cny": 19370672925313.75,
       "czk": 62566330780544.055,
       "dkk": 18433261343562.234,
       "eur": 2469945601975.0513,
       "gbp": 2119257250922.996,
       "gel": 7177894397411.757,
       "hkd": 20971102327244.14,
       "huf": 964402339508969.6,
       "idr": 42552459594208350,
       "ils": 10078567229607.635,
       "inr": 223096092912854.12,
       "jpy": 406046522432689.44,
       "krw": 3619131733792255,
       "kwd": 823639277233.756,
       "lkr": 799780218731999.9,
       "mmk": 5616575410985046,
       "mxn": 44067986290020.33,
       "myr": 12715318526758.35,
       "ngn": 3467447773023263,
       "nok": 28736753786414.105,
       "nzd": 4453473690816.823,
       "php": 151566063853517.4,
       "pkr": 743342690229585.5,
       "pln": 10577717470339.895,
       "rub": 247763071638775.28,
       "sar": 10046446152179.197,
       "sek": 28596369706249.793,
       "sgd": 3614155535298.586,
       "thb": 98077889305898.12,
       "try": 85897704233016.94,
       "twd": 86044205593331.94,
       "uah": 104010435095271.5,
       "vef": 268180061945.08957,
       "vnd": 66866055382163870,
       "zar": 50076526697167.12,
       "xdr": 2020063035660.8538,
       "xag": 97453683003.52254,
       "xau": 1149534431.107886,
       "bits": 39150177835262.57,
       "sats": 3915017783526256.5
     },
     "total_volume": {
       "btc": 987029.4385454208,
       "eth": 20116138.36895381,
       "ltc": 674804359.7124188,
       "bch": 97992615.08150195,
       "bnb": 115272455.19841261,
       "eos": 66671220108.51619,
       "xrp": 114555903383.86882,
       "xlm": 525848573386.0228,
       "link": 3860857363.2705646,
       "dot": 7991274346.584726,
       "yfi": 8087761.694328762,
       "usd": 67524074027.782646,
       "aed": 247968657052.22614,
       "ars": 58108419235441.35,
       "aud": 102606206688.91743,
       "bdt": 7400605629220.937,
       "bhd": 25455495523.289658,
       "bmd": 67524074027.782646,
       "brl": 342083036191.4094,
       "cad": 91768592807.45805,
       "chf": 60898814456.398766,
       "clp": 64110732085678.32,
       "cny": 488361112998.5353,
       "czk": 1577382626511.2112,
       "dkk": 464727687088.8118,
       "eur": 62270701068.42124,
       "gbp": 53429368911.51948,
       "gel": 180964518394.4573,
       "hkd": 528710123433.8373,
       "huf": 24313899765738.945,
       "idr": 1072805607134900.2,
       "ils": 254094441048.0271,
       "inr": 5624557115832.948,
       "jpy": 10236987242981.96,
       "krw": 91243252540462.62,
       "kwd": 20765070769.097775,
       "lkr": 20163551327313.797,
       "mmk": 141601534935030.4,
       "mxn": 1111014104423.527,
       "myr": 320570541446.8984,
       "ngn": 87419092781491.77,
       "nok": 724492799873.6913,
       "nzd": 112278152480.43436,
       "php": 3821187416756.299,
       "pkr": 18740684174448.52,
       "pln": 266678700152.363,
       "rub": 6246445329595.503,
       "sar": 253284624828.21136,
       "sek": 720953525533.5249,
       "sgd": 91117795781.9783,
       "thb": 2472677504114.109,
       "try": 2165598407706.1016,
       "twd": 2169291907031.3489,
       "uah": 2622245083711.565,
       "vef": 6761185532.401877,
       "vnd": 1685784554525295.8,
       "zar": 1262497612097.4534,
       "xdr": 50928547305.82652,
       "xag": 2456940410.9452662,
       "xau": 28981332.572724365,
       "bits": 987029438545.4208,
       "sats": 98702943854542.08
     },
     "market_cap_percentage": {
       "btc": 50.25571041539062,
       "eth": 15.05355897721245,
       "usdt": 3.9893957018600408,
       "bnb": 3.3650804365083777,
       "sol": 2.9491627834907654,
       "usdc": 1.2291662709270723,
       "xrp": 1.2115027387339408,
       "steth": 1.1933538806598154,
       "doge": 0.991782173801951,
       "ada": 0.7663186646169118
     },
     "market_cap_change_percentage_24h_usd": 1.0213146410681784,
     "updated_at": 1712440030
   }
 }
 */


struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        
        return ""
    }
}
